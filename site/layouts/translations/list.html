{{- define "main" }}
  {{- $guidePage := .Site.GetPage (printf "/%s/guide" .Site.Language.Lang) | default (.Site.GetPage "/guide") }}
  {{- $isComingSoon := and $guidePage $guidePage.Date (lt now $guidePage.Date) (eq hugo.Environment "production") }}
  <section class="container my-5">
    <div class="row">
      <div class="col-12">
        <h1 class="mb-4">{{ i18n "download_page_title" $guidePage }}</h1>

        <p class="lead mb-4">
          {{ i18n "download_page_description" $guidePage }}
          {{- $creators := .Site.GetPage "/creators" }}
          {{- $creatorPages := $creators.Pages }}
          {{- range $index, $creator := $creatorPages }}
            {{- if $index }},{{ end }}
            {{- if gt (len $creatorPages) 1 }}{{ if eq $index (sub (len $creatorPages) 1) }}&nbsp;{{ i18n "and" }}{{ end }}{{ end }}
            <a href="{{ $creator.Permalink }}" class="text-decoration-none">{{ $creator.Title }}</a>
          {{- end }}
          {{ i18n "download_page_originators" $guidePage }}
        </p>

        <p class="mb-4">{{ i18n "download_translations_provided" . }}</p>

        <p class="mb-5">{{ i18n "download_translation_error" $guidePage }} {{ .Site.Params.supportEmail }}</p>

        <!-- Official Version -->
        {{ partial "components/translations/official-version.html" . }}

        {{ partial "components/translations/community-translations.html" . }}


        <!-- Preview Translations -->
        {{- $previewTranslations := partial "functions/get-translations.html" (dict "type" "preview" "Site" .Site) }}
        {{- if gt (len $previewTranslations) 0 }}
          <h2 class="mb-3">{{ i18n "download_preview_translations" . | default "Preview Translations" }}</h2>
          <p class="text-muted mb-3">
            <small>
              {{ i18n "download_preview_description" . | default "These translations are available in preview and will be moved to the main site once ready." }}
              <a href="{{ .Site.Params.previewSiteUrl }}" target="_blank" rel="noopener" class="text-decoration-none">
                {{ i18n "download_visit_preview" . | default "Visit preview site" }}
                <i class="fa-solid fa-external-link-alt ms-1"></i>
              </a>
            </small>
          </p>

          <!-- Table Headers (visible on larger screens) -->
          <div class="d-none d-md-block mb-3">
            <div class="row fw-bold text-muted border-bottom pb-2">
              <div class="col-md-4">{{ i18n "download_table_language" . }}</div>
              <div class="col-md-4">{{ i18n "download_table_status" . | default "Status" }}</div>
              <div class="col-md-4">{{ i18n "download_table_action" . }}</div>
            </div>
          </div>

          <!-- Preview Translation Cards/Rows -->
          <div class="mb-5">
            {{- range $previewTranslations }}
              <!-- Mobile Card -->
              <div class="card mb-3 d-md-none">
                <div class="card-body">
                  <h6 class="card-title mb-2">{{ .name }}</h6>
                  <p class="card-text mb-3">
                    <span class="badge bg-warning text-dark">
                      {{ if eq .status "reference" }}
                        <i class="fa-solid fa-book-reader me-1"></i>{{ i18n "download_reference_status" . | default "Reference" }}
                      {{ else }}
                        <i class="fa-solid fa-flask me-1"></i>{{ i18n "download_preview_status" . | default "In Preview" }}
                      {{- end }}
                    </span>
                  </p>
                  <div class="d-flex gap-2 flex-wrap">
                    <!-- Preview Reading Link -->
                    <a href="/{{ .code }}/" class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener">
                      <i class="fa-solid fa-eye me-1"></i>{{ i18n "download_preview_action" . | default "Preview" }}
                    </a>
                    <!-- Discussion Link -->
                    {{- if .discussionId }}
                      <a href="{{ $.Site.Params.githubUrl }}/discussions/{{ .discussionId }}" class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">
                        <i class="fa-solid fa-comments me-1"></i>{{ i18n "download_discussion_action" . | default "Discussion" }}
                      </a>
                    {{- end }}
                  </div>
                </div>
              </div>

              <!-- Desktop Row -->
              <div class="row d-none d-md-flex align-items-center py-3 border-bottom">
                <div class="col-md-4">{{ .name }}</div>
                <div class="col-md-4">
                  <span class="badge bg-warning text-dark">
                    {{ if eq .status "reference" }}
                      <i class="fa-solid fa-book-reader me-1"></i>{{ i18n "download_reference_status" . | default "Reference" }}
                    {{ else }}
                      <i class="fa-solid fa-flask me-1"></i>{{ i18n "download_preview_status" . | default "In Preview" }}
                    {{- end }}
                  </span>
                </div>
                <div class="col-md-4">
                  <div class="d-flex gap-2">
                    <!-- Preview Reading Link -->
                    <a href="/{{ .code }}/" class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener">
                      <i class="fa-solid fa-eye me-1"></i>{{ i18n "download_preview_action" . | default "Preview" }}
                    </a>
                    <!-- Discussion Link -->
                    {{- if .discussionId }}
                      <a href="{{ $.Site.Params.githubUrl }}/discussions/{{ .discussionId }}" class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">
                        <i class="fa-solid fa-comments me-1"></i>{{ i18n "download_discussion_action" . | default "Discussion" }}
                      </a>
                    {{- end }}
                  </div>
                </div>
              </div>
            {{- end }}
          </div>
        {{- end }}

      </div>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Add event listeners to all PDF download links
      document.querySelectorAll(".pdf-download").forEach(function (link) {
        link.addEventListener("click", function (e) {
          // Get data attributes
          const language = this.dataset.language;
          const languageCode = this.dataset.languageCode;
          const type = this.dataset.type;
          const filename = this.dataset.filename;

          // Track the download event
          if (typeof gtag !== "undefined") {
            gtag("event", "download", {
              event_category: "PDF",
              event_label: language + " - " + type,
              file_name: filename,
              file_extension: "pdf",
              language_code: languageCode,
            });
          }
        });
      });
    });
  </script>
{{- end }}
{{- define "template" }}
  download/list.html
{{- end }}
